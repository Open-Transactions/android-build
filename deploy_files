#!/bin/bash

source "${HOME}"/bin/functions
source "${HOME}"/bin/android-armv7a

OT_DIR="${SRC_DIR}/${FOLDER_OPENTXS_OT}"
OT_VERSION="$(git -C ${OT_DIR} describe)"

STASH_WALLET="/home/build/stash-wallet"
JNILIBS="${STASH_WALLET}/app/src/main/jniLibs/"
JAVA_FILES="${STASH_WALLET}/app/src/main/java/"

git -C "${STASH_WALLET}" remote update -p
git -C "${STASH_WALLET}" checkout master
git -C "${STASH_WALLET}" reset --hard stash/master
rsync -avX --delete "${FINAL_OUTPUT_DIR_OT}/android_libs/" "${JNILIBS}"
rsync -avX --delete "${FINAL_OUTPUT_DIR_OT}/java/org/opentransactions/" "${JAVA_FILES}/org/opentransactions/"
git -C "${STASH_WALLET}" add .
git -C "${STASH_WALLET}" commit -a -S -m "Update for opentxs-${OT_VERSION}"
git -C "${STASH_WALLET}" push --force build master
git -C "${STASH_WALLET}" push stash master
